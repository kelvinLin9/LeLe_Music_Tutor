import{az as I,Z as O,aA as z,H as n}from"./index-6bf52aae.js";import{S as r}from"./sweetalert2-a2985e93.js";const c=r.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:o=>{o.onmouseenter=r.stopTimer,o.onmouseleave=r.resumeTimer}});r.mixin({toast:!1,icon:"error",iconColor:"#be0e3d",confirmButtonColor:"#be0e3d"});const G=(o,s)=>{c.fire({title:o||"An unknown error occurred",Text:s||"",icon:"error"})},g=(o,s)=>async(...d)=>{try{return await o(...d)}catch(i){return console.error("Error occurred:",i),G(i.response.data.message),!1}finally{s&&s()}},a=I.create({baseURL:"https://music-tutor-backend.onrender.com"});a.interceptors.request.use(o=>{const s=localStorage.getItem("lele_music_tutor_token");return s&&(o.headers.Authorization=s),o},o=>Promise.reject(o));a.interceptors.response.use(o=>o,o=>Promise.reject(o));const $=o=>a.post("/users/login",o),j=o=>a.post("/users/signup",o),D=()=>a.get("/users/check"),R=()=>a.get("/users/profile"),q=o=>a.post("/users/googleClient/callback",o),H=o=>a.get("/admin/users",{params:o}),V=o=>a.put("admin/users",o),Z=o=>a.delete(`/admin/users/${o}`),M=O("userStore",()=>{const o=z(),s=n({}),d=n(!0),i=n(!1),E=g(async e=>{i.value=!0;const t=await $(e);return document.cookie=`music_tutor_beta=${t.data.token}`,s.value=t.data.user,console.log("login",s.value),c.fire({icon:"success",title:"登入成功"}),o.push("/"),!0},()=>i.value=!1),U=g(async e=>{console.log("googleLogin",e),i.value=!0;const t=await q(e);console.log(t),t.data.status===!0&&(localStorage.setItem("lele_music_tutor_token",t.data.token),s.value=t.data.user,console.log("googleLogin",s.value),c.fire({icon:"success",title:"登入成功"}),o.push("/"))},()=>i.value=!1),m=n(!1),b=g(async e=>{m.value=!0;const t=await j(e);console.log(t),c.fire({icon:"success",title:"註冊成功，請登入"}),d.value=!0},()=>m.value=!1),B=async()=>{try{const e=await D();console.log(e),s.value=e.data.user,s.value,console.log("checkUser 驗證成功")}catch(e){console.log("checkUser 驗證失敗",e)}},L=()=>{document.cookie="music_tutor_beta=",s.value={},c.fire({icon:"success",title:"已登出"}),o.push("/login")},l=n(!1),w=async()=>{try{const e=await R();console.log(e),s.value=e.data.result}catch(e){console.log("get user 失敗",e)}},_=async()=>{r.fire({title:"請輸入您的Email",input:"text",inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:async e=>{console.log(e),(await axiosVerifyEmail(e)).data.result.isEmailExists?h(e):r.fire({title:"Email不存在",text:"請確認Email",icon:"error"})},allowOutsideClick:()=>!r.isLoading()})},h=async e=>{try{const t=await axiosGenerateEmailCode(e);console.log("已將驗證信發送到您的信箱",t),r.fire({title:"已將驗證信發送到您的信箱",text:"請設定新密碼",icon:"success",preConfirm:()=>{r.fire({title:"請輸入新密碼及驗證碼",html:`
          <label for="swal-input1">請輸入驗證碼</label>
          <input id="swal-input1" class="swal2-input">
          <label for="swal-input2">請輸入新密碼</label>
          <input id="swal-input2" class="swal2-input" type="password">
        `,inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:()=>{const u=document.getElementById("swal-input1"),S=document.getElementById("swal-input2");console.log(S.value,u.value)},allowOutsideClick:()=>!r.isLoading()})}})}catch(t){console.log("generateEmailCode 失敗",t),r.fire({title:"發送驗證碼失敗",icon:"error"})}},v=async()=>{try{await v(),c.fire({icon:"success",title:"重置密碼郵件已發送，請檢查您的郵箱。"})}catch{}},A=()=>{},f=n([]),T=n({}),y=n(1),x=n(10),k=n(1),C=n("createdAt"),p=g(async e=>{l.value=!0;const t=await H(e);console.log(t.data),f.value=t.data.users,y.value=t.data.page,x.value=t.data.limit,k.value=t.data.totalPages,C.value=t.data.sortBy,console.log("getUsers",f.value)},()=>l.value=!1),P=g(async e=>{l.value=!0;const t={_id:e._id,name:e.name,email:e.email,role:e.role,phone:e.phone,address:e.address,birthday:e.birthday,gender:e.gender,photo:e.photo,intro:e.intro,facebook:e.facebook,instagram:e.instagram,discord:e.discord};console.log(t);const u=await V(t);console.log("editUser",u.data),u.data.status&&(p(),w()),c.fire({icon:"success",title:"編輯成功"})},()=>l.value=!1);return{loginLoading:i,showLogInPage:d,login:E,googleLogin:U,signupLoading:m,signup:b,checkUser:B,logout:L,userInfo:s,getUser:w,users:f,userTemp:T,userLoading:l,page:y,limit:x,totalPages:k,sortBy:C,getUsers:p,editUser:P,deleteUser:async e=>{r.fire({title:"確定要刪除這個用戶嗎？",text:"你將無法撤銷此操作！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的，刪除它！",cancelButtonText:"取消"}).then(t=>{t.isConfirmed&&(l.value=!0,Z(e).then(u=>{r.fire("已刪除！","用戶已被刪除。","success"),console.log(u),p()}))})},verifyEmail:_,generateEmailCode:h,forgotPassword:v,resetPasswordEmail:A}});export{M as u};
